---
title: "chapter3"
author: "Susanne Csader"
date: "11/9/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
# Chapter 3: Logistic regression

# Data Analysis

**reading the data**
```{r}
alc <- read.csv("https://github.com/rsund/IODS-project/raw/master/data/alc.csv")
```
To look at the dimension and structure of the data.
FOr a description of the variables see [here](https://archive.ics.uci.edu/ml/datasets/Student+Performance)
```{r}
dim(alc)
str(alc)
```
This matched data set contains now 370 obervations and 51 variables.
The data are student achievement in secondary education of 2 schools. It is shown from which school the pupils are, their age, sex, if they live in urban or rural area, etc and it cointain also their alcohol consumption and weather it is high or not.

**hypothesis towards alcohol**

The use of alcohol can have certain numbers of reason. For my analysis I will use the gender, the class failure, quality of family relationship, going out with friends. 
The gender is interesting because male and female handle the alcohol consumption in a different way. normally females drink more often with friends, whereas males also drink more often alone. ALso the drinks are usually different. Males drink more beer and strong liquids, females more sparkling wine, wine and longdrinks.SO male drink more than female (my hypothesis :) )
Class failure could be also interesting. The more failure the more the tendency to drink. 
IS the family a supportive and cosy environment (quality of fam relationship), the alcohol consumption should be less (less wrong friends, stronger resilience)
And of course, if you go out with friends the tendency to drink will be probably higher. Even when you have not a good family life.


**testing the hypothesis**

```{r}
library(tidyr); library(dplyr); library(ggplot2)#reading some libraries
gather(alc) %>% ggplot(aes(value)) + facet_wrap("key", scales = "free") + geom_bar() #overall view
```

*crosstable*
```{r}
alc %>% group_by(sex, high_use) %>% summarise(count = n())
alc %>% group_by(failures, high_use) %>% summarise(count = n())
alc %>% group_by(famrel, high_use) %>% summarise(count = n())
alc %>% group_by(goout, high_use) %>% summarise(count = n())
```

*barplot*

*boxplot*


**logistic regression**

*model*
```{r}
m <- glm(high_use ~ failures + absences + sex, data = alc, family = "binomial")

summary(m)

coef(m)
```


*odd ratio and confidence intervals (CI)*
```{r}
OR <- coef(m) %>% exp

CI <- confint(m) %>% exp 

cbind(OR, CI)
```

**predictive model**

```{r}
m <- glm(high_use ~ goout + famrel + sex, data = alc, family = "binomial")

probabilities <- predict(m, type = "response")# predict() the probability of high_use

alc <- mutate(alc, probability = probabilities)# add the predicted probabilities to 'alc'

alc <- mutate(alc, prediction = probability > 0.5)# use the probabilities to make a prediction of high_use

select(alc, goout, famrel, sex, high_use, probability, prediction) %>% tail(10)

table(high_use = alc$high_use, prediction = alc$prediction)
```

*visual probability*
```{r}

g <- ggplot(alc, aes(x = probability, y = high_use, col = prediction))+ geom_point()

g 

table(high_use = alc$high_use, prediction = alc$prediction) %>% prop.table %>% addmargins# tabulate the target variable versus the predictions
```
